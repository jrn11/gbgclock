<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gettysburg Clock</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: url('background.jpeg') no-repeat center center fixed;
      background-size: cover;
      color: white;
      margin: 40px;
      min-height: 100vh;
      text-shadow: 0 1px 4px rgba(0,0,0,0.6);
    }
    h1 { text-align: center; font-size: 2.8em; margin-bottom: 40px; }
    .converter {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 18px;
      max-width: 1300px;
      margin: 0 auto;
    }
    .zone {
      background: rgba(0,0,0,0.45);
      padding: 18px 14px;
      border-radius: 12px;
      text-align: center;
      transition: all .3s;
      backdrop-filter: blur(4px);
      border: 1px solid rgba(255,255,255,.15);
    }
    .zone.active {
      background: rgba(30,100,200,0.7);
      transform: translateY(-6px);
      box-shadow: 0 10px 30px rgba(0,0,0,.5);
      border-color: rgba(100,180,255,.8);
    }
    label { font-weight: bold; font-size: 1.1em; margin-bottom: 8px; display: block; }
    small { opacity: 0.9; }
    input {
      width: 100%; padding: 12px 8px; font-size: 1.5em; font-weight: bold;
      text-align: center; background: rgba(255,255,255,.15); border: none;
      border-radius: 8px; color: white; box-sizing: border-box;
    }
    input::placeholder { color: rgba(255,255,255,.5); }
    input:focus { outline: none; background: rgba(255,255,255,.3); }
    .note { text-align: center; margin-top: 40px; opacity: 0.9; }
  </style>
</head>
<body>

<h1>Gettysburg Clock</h1>
<div class="converter" id="converter"></div>
<p class="note">
  Type any time (0400, 4am, 3:15pm, 16:30…) — works perfectly from every zone including Zulu.
</p>

<script>
  const zones = [
    { name: "Pacific",    abbr: "PT", iana: "America/Los_Angeles" },
    { name: "Mountain",   abbr: "MT", iana: "America/Denver" },
    { name: "Central",    abbr: "CT", iana: "America/Chicago" },
    { name: "Eastern",    abbr: "ET", iana: "America/New_York" },
    { name: "Atlantic",   abbr: "AT", iana: "America/Halifax" },
    { name: "Zulu (UTC)", abbr: "Z",  iana: "UTC" }
  ];

  // Build UI
  zones.forEach(z => {
    document.getElementById("converter").innerHTML += `
      <div class="zone">
        <label>${z.name}<br><small>${z.abbr}</small></label>
        <input type="text" placeholder="--:--" data-iana="${z.iana}">
      </div>`;
  });

  const inputs = document.querySelectorAll("input");

  // Get current offset in minutes for a given IANA zone (handles DST automatically)
  function getCurrentOffsetMinutes(iana) {
    const now = new Date();
    const utc = Date.UTC(
      now.getUTCFullYear(),
      now.getUTCMonth(),
      now.getUTCDate(),
      now.getUTCHours(),
      now.getUTCMinutes(),
      now.getUTCSeconds()
    );
    const local = new Date(now.toLocaleString("en-US", { timeZone: iana }));
    return (local - new Date(utc)) / 60000;  // difference in minutes
  }

  // Pre-calculate offsets once
  const offsets = {};
  zones.forEach(z => offsets[z.iana] = getCurrentOffsetMinutes(z.iana));

  // Display formatters (cached)
  const displayFmt = {};
  zones.forEach(z => {
    displayFmt[z.iana] = new Intl.DateTimeFormat('en-US', {
      timeZone: z.iana,
      hour: '2-digit',
      minute: '2-digit',
      hour12: false,
      hourCycle: 'h23'
    });
  });

  function parseTime(str) {
    str = str.trim().toLowerCase().replace(/\s+/g, '');
    let h, m = 0;
    const m24 = str.match(/^(\d{1,2}):?(\d{2})$/);
    const m12 = str.match(/^(\d{1,2}):?(\d{0,2})(am|pm)$/);
    if (m24) { h = +m24[1]; m = +m24[2]; }
    else if (m12) {
      h = +m12[1]; m = m12[2] ? +m12[2] : 0;
      if (m12[3] === 'pm' && h !== 12) h += 12;
      if (m12[3] === 'am' && h === 12) h = 0;
    } else return null;
    if (h > 23 || m > 59) return null;
    return h * 60 + m; // minutes since midnight
  }

  function updateAll(sourceInput) {
    const srcIana = sourceInput.dataset.iana;
    const minutes = parseTime(sourceInput.value);

    // Highlight
    document.querySelectorAll('.zone').forEach(z => z.classList.remove('active'));
    sourceInput.closest('.zone').classList.add('active');

    if (minutes === null) {
      inputs.forEach(i => { if (i !== sourceInput) i.value = ''; });
      return;
    }

    // Convert source local minutes → UTC minutes
    const utcMinutes = (minutes - offsets[srcIana] + 1440) % 1440;

    // Convert UTC minutes → every other zone
    inputs.forEach(inp => {
      if (inp === sourceInput) return;
      const targetMinutes = (utcMinutes + offsets[inp.dataset.iana] + 1440) % 1440;
      const h = Math.floor(targetMinutes / 60) % 24;
      const m = targetMinutes % 60;
      inp.value = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
    });
  }

  // Events
  inputs.forEach(inp => {
    inp.addEventListener('focus', () => {
      document.querySelectorAll('.zone').forEach(z => z.classList.remove('active'));
      inp.closest('.zone').classList.add('active');
    });
    inp.addEventListener('input', () => updateAll(inp));
  });

  // Show real current time on load
  window.addEventListener('load', () => {
    const now = new Date();
    inputs.forEach(inp => {
      inp.value = displayFmt[inp.dataset.iana].format(now);
    });
  });
</script>
</body>
</html>
